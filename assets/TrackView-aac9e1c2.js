import{r as I,t as l,s as c,_ as h,a as m,c as d,b as r,F as T,e as v,f as p,i as f,p as w,h as S}from"./index-2c932901.js";import{T as u}from"./track-03cf0993.js";let _=null,y=null;const B={name:"TrackView",data(){return{trackingTime:"",intervalId:_,autocompletionItems:I([])}},methods:{async toggleTracking(){l.show(),document.getElementById("trackingToggle"),this.isIntervalRunning()?this.stopTracking().then(()=>{l.hide()}):this.startTracking().then(()=>{l.hide()})},async startTracking(){const e=new Date,t=new u(c),n=document.getElementById("trackingToggle"),i=document.getElementById("titleInput");this.startInterval(e),n.innerHTML="Stop Tracking",await t.start(i.value,e).then(o=>{o.error?(console.log(o.error),n.innerHTML="Start Tracking",this.stopInterval(),this.trackingTime="--:--:--"):console.log("tracking started!")})},async stopTracking(){const e=new Date,t=new u(c),n=document.getElementById("trackingToggle"),i=document.getElementById("titleInput");this.stopInterval(),this.trackingTime="00:00:00",i.value="",sessionStorage.removeItem("trackingTitle"),n.innerHTML="Start Tracking",await t.stop(e).then(o=>{o.error&&console.log(o.error),this.fetchAutocompletionItems(),console.log("tracking stopped!")})},async updateTracking(e){var g;const t=new u(c),{data:n,error:i}=await t.getCurrentTracking(),o=n!=null&&n.start?new Date(n.start):null;if(i){console.log(i);return}const s=document.getElementById("trackingToggle"),a=document.getElementById("titleInput");o&&!this.isIntervalRunning()?(console.log("tracking has changed to running"),this.startInterval(o),s.innerHTML="Stop Tracking"):!o&&this.isIntervalRunning()&&(console.log("tracking has changed to stopped"),this.trackingTime="00:00:00",a.value="",sessionStorage.removeItem("trackingTitle"),this.stopInterval(),s.innerHTML="Start Tracking"),this.isIntervalRunning()?(a.value=((g=e.title)==null?void 0:g.toString())||"",sessionStorage.setItem("trackingTitle",a.value)):a.value=sessionStorage.getItem("trackingTitle")||""},startInterval(e){const n=new Date().getTime()-e.getTime(),i=new Date(n);this.trackingTime=this.formatDate(i),this.intervalId=setInterval(()=>{const s=new Date().getTime()-e.getTime(),a=new Date(s);this.trackingTime=this.formatDate(a)},1e3)},stopInterval(){clearInterval(this.intervalId),this.intervalId=null},isIntervalRunning(){return this.intervalId!=null},formatDate(e){const t=e.getUTCHours().toString().padStart(2,"0"),n=e.getUTCMinutes().toString().padStart(2,"0"),i=e.getUTCSeconds().toString().padStart(2,"0");return`${t}:${n}:${i}`},async updateTitle(){const e=document.getElementById("titleInput"),t=new u(c);sessionStorage.setItem("trackingTitle",e.value),this.isIntervalRunning()&&await t.update({title:e.value},null)},async updateAutocompletion(){const e=document.getElementById("titleInput");sessionStorage.getItem("autocompletionItems")||await this.fetchAutocompletionItems();const t=e.value.toLowerCase(),n=JSON.parse(sessionStorage.getItem("autocompletionItems")||"[]");if(e.value.length==0){this.autocompletionItems=n.slice(0,1);return}const i=n.filter(o=>o.title.toLowerCase().includes(t));i.sort((o,s)=>s.amount-o.amount),this.autocompletionItems=i.slice(0,3)},selectAutocompleteItem(e){const t=document.getElementById("titleInput"),n=e.title;t.value=n,this.updateTitle(),this.autocompletionItems=[]},async fetchAutocompletionItems(){const t=await new u(c).getTitles();if(t.error){console.log(t.error);return}sessionStorage.setItem("autocompletionItems",JSON.stringify(t.data))}},setup(){const e=I("--:--:--");return l.show(),{trackingTime:e}},async mounted(){const e=new u(c);await e.getCurrentTracking().then(t=>{var i;const n=(i=t.data)!=null&&i.start?new Date(t.data.start):null;if(t.error){console.log(t.error),l.hide();return}n||(this.trackingTime="00:00:00"),this.updateTracking(t.data)}),await e.getTitles().then(t=>{if(t.error){console.log(t.error);return}sessionStorage.setItem("autocompletionItems",JSON.stringify(t.data))}),document.addEventListener("click",t=>{const n=document.getElementById("titleInput");t.target!=n&&(this.autocompletionItems=[])}),y=c.channel("public:trackings").on("postgres_changes",{event:"*",schema:"public",table:"trackings"},async t=>{this.updateTracking(t.new)}).subscribe(),l.hide()}};const k=e=>(w("data-v-ee96f85d"),e=e(),S(),e),D=k(()=>r("h1",{class:"title"},"Current Tracking",-1)),E={class:"tracking-container"},C={class:"autocomplete"},b={class:"tracking-title-container"},A={class:"autocomplete-items"},L=["onClick"],R=k(()=>r("br",null,null,-1)),x={style:{"font-size":"small"}},H={class:"tracking-time",id:"trackingTime"};function M(e,t,n,i,o,s){return m(),d("main",null,[D,r("div",E,[r("div",C,[r("div",b,[r("input",{autocomplete:"off",class:"tracking-title",type:"text",placeholder:"Title",id:"titleInput",onChange:t[0]||(t[0]=(...a)=>s.updateTitle&&s.updateTitle(...a)),onFocusin:t[1]||(t[1]=(...a)=>s.updateAutocompletion&&s.updateAutocompletion(...a)),onKeyup:t[2]||(t[2]=(...a)=>s.updateAutocompletion&&s.updateAutocompletion(...a))},null,32)]),r("div",A,[(m(!0),d(T,null,v(o.autocompletionItems,a=>(m(),d("div",{onClick:g=>s.selectAutocompleteItem(a)},[f(p(a.title)+" ",1),R,r("p",x,p(new Date(a.last_use).toLocaleDateString()),1)],8,L))),256))])]),r("h3",H,p(i.trackingTime),1)]),r("a",{id:"trackingToggle",class:"button is-primary",href:"#",onClick:t[3]||(t[3]=(...a)=>s.toggleTracking&&s.toggleTracking(...a))},"Start Tracking")])}const F=h(B,[["render",M],["__scopeId","data-v-ee96f85d"]]);export{F as default};
