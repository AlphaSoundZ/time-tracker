import{d as v,r as T,o as y,s,a as d,c as i,b as n,F as M,e as I,t as r,f as D,p as V,g as x,_ as C}from"./index-bde6c963.js";import{faker as E}from"https://cdn.skypack.dev/@faker-js/faker";const c=u=>(V("data-v-59e7d905"),u=u(),x(),u),L={class:"container"},k=c(()=>n("h1",null,"Dashboard",-1)),B={key:0},N={class:"table"},$=c(()=>n("thead",null,[n("tr",null,[n("th",null,"Title"),n("th",null,"Date"),n("th",null,"Start"),n("th",null,"End"),n("th",null,"Duration")])],-1)),F=c(()=>n("td",{colspan:"4"},"Total",-1)),O={key:1,class:"title"},j=c(()=>n("h2",null,"No trackings yet",-1)),A=[j],q=c(()=>n("br",null,null,-1)),z=v({__name:"DashboardView",setup(u){const l=T([]);async function f(){const{data:t}=await s.from("trackings").select();l.value=t,s.channel("any").on("postgres_changes",{event:"*",schema:"public",table:"trackings"},a=>{f()}).subscribe()}async function w(){var g;const{data:t,error:a}=await s.auth.getSession();if(!t)return;const e=(g=t.session)==null?void 0:g.user,o=E.lorem.words(3),h=new Date(new Date().getTime()-Math.floor(Math.random()*1e10)).toISOString(),_=new Date(new Date(h).getTime()+Math.floor(Math.random()*5e7)).toISOString();await s.from("trackings").insert([{title:o,start:h,end:_,user:e==null?void 0:e.id}])}function b(t){if(!t.end)return"in progress";const a=new Date(t.start),o=new Date(t.end).getTime()-a.getTime();return m(o)}function m(t){t=new Date(t).getTime();const a=Math.floor(t/1e3/60/60),e=Math.floor(t/1e3/60)%60,o=Math.floor(t/1e3)%60;return[a,e,o].map(_=>String(_).padStart(2,"0")).join(":")}function p(t){if(t)return new Date(t).toLocaleTimeString().slice(0,8)}function S(t){let a=new Date(t.start).toLocaleDateString();if(t.end){let e=new Date(t.end).toLocaleDateString();return a===e?a:`${a} - ${e}`}return a}return y(async()=>{var e;const{data:t,error:a}=await s.auth.getSession();t&&((e=t.session)==null||e.user,f(),s.channel("any").on("postgres_changes",{event:"*",schema:"public",table:"trackings"},o=>{console.log("Change received!",o)}).subscribe())}),(t,a)=>(d(),i("div",L,[k,l.value.length!==0?(d(),i("div",B,[n("table",N,[$,n("tbody",null,[(d(!0),i(M,null,I(l.value,e=>(d(),i("tr",{key:e.id},[n("td",null,r(e.title),1),n("td",null,r(S(e)),1),n("td",null,r(p(e.start)),1),n("td",null,r(e.end?p(e.end):""),1),n("td",null,r(b(e)),1)]))),128))]),n("tfoot",null,[n("tr",null,[F,n("td",null,r(m(l.value.map(e=>e.end?new Date(e.end).getTime()-new Date(e.start).getTime():0).reduce((e,o)=>e+o,0))),1)])])])])):D("",!0),l.value.length===0?(d(),i("div",O,A)):D("",!0),q,n("a",{href:"#",onClick:a[0]||(a[0]=e=>w())},"Add Tracking")]))}});const J=C(z,[["__scopeId","data-v-59e7d905"]]);export{J as default};
