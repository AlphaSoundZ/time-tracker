import{d as v,r as T,o as y,s,a as d,c as i,b as n,F as M,e as I,t as r,f as D,p as V,g as x,_ as C}from"./index-0fac5c0e.js";import{faker as E}from"https://cdn.skypack.dev/@faker-js/faker";const c=u=>(V("data-v-066923d2"),u=u(),x(),u),L={class:"container"},k=c(()=>n("h1",null,"Dashboard",-1)),B={key:0},N={class:"table"},$=c(()=>n("thead",null,[n("tr",null,[n("th",null,"Title"),n("th",null,"Date"),n("th",null,"Start"),n("th",null,"End"),n("th",null,"Duration")])],-1)),F=c(()=>n("td",{colspan:"4"},"Total",-1)),O={key:1,class:"title"},j=c(()=>n("h2",null,"No trackings yet",-1)),A=[j],q=c(()=>n("br",null,null,-1)),z=v({__name:"DashboardView",setup(u){const l=T([]);async function f(){const{data:e}=await s.from("trackings").select();l.value=e,s.channel("any").on("postgres_changes",{event:"*",schema:"public",table:"trackings"},a=>{f()}).subscribe()}async function w(){var g;const{data:e,error:a}=await s.auth.getSession();if(!e)return;const t=(g=e.session)==null?void 0:g.user,o=E.lorem.words(3),h=new Date(new Date().getTime()-Math.floor(Math.random()*1e10)).toISOString(),_=new Date(new Date(h).getTime()+Math.floor(Math.random()*5e7)).toISOString();await s.from("trackings").insert([{title:o,start:h,end:_,user:t==null?void 0:t.id}])}function b(e){if(!e.end)return"in progress";const a=new Date(e.start),o=new Date(e.end).getTime()-a.getTime();return m(o)}function m(e){e=new Date(e).getTime();const a=Math.floor(e/1e3/60/60),t=Math.floor(e/1e3/60)%60,o=Math.floor(e/1e3)%60;return[a,t,o].map(_=>String(_).padStart(2,"0")).join(":")}function p(e){if(e)return new Date(e).toLocaleTimeString().slice(0,8)}function S(e){let a=new Date(e.start).toLocaleDateString();if(e.end){let t=new Date(e.end).toLocaleDateString();return a===t?a:`${a} - ${t}`}return a}return y(async()=>{var t;const{data:e,error:a}=await s.auth.getSession();e&&((t=e.session)==null||t.user,f(),s.channel("any").on("postgres_changes",{event:"*",schema:"public",table:"trackings"},o=>{console.log("Change received!",o)}).subscribe())}),(e,a)=>(d(),i("div",L,[k,l.value.length!==0?(d(),i("div",B,[n("table",N,[$,n("tbody",null,[(d(!0),i(M,null,I(l.value,t=>(d(),i("tr",{key:t.id},[n("td",null,r(t.title),1),n("td",null,r(S(t)),1),n("td",null,r(p(t.start)),1),n("td",null,r(t.end?p(t.end):""),1),n("td",null,r(b(t)),1)]))),128))]),n("tfoot",null,[n("tr",null,[F,n("td",null,r(m(l.value.map(t=>t.end?new Date(t.end).getTime()-new Date(t.start).getTime():0).reduce((t,o)=>t+o,0))),1)])])])])):D("",!0),l.value.length===0?(d(),i("div",O,A)):D("",!0),q,n("a",{href:"#",onClick:a[0]||(a[0]=t=>w())},"Add Tracking")]))}});const J=C(z,[["__scopeId","data-v-066923d2"]]);export{J as default};
