import{r as h,t as l,s as c,T as u,_ as k,a as m,c as d,b as r,F as T,e as v,f as p,i as f,p as w,h as _,j as S}from"./index-3d9134b1.js";let y=null,B=null;const D={name:"TrackView",data(){return{trackingTime:"",intervalId:y,autocompletionItems:h([])}},methods:{async toggleTracking(){l.show(),document.getElementById("trackingToggle"),this.isIntervalRunning()?this.stopTracking().then(()=>{l.hide()}):this.startTracking().then(()=>{l.hide()})},async startTracking(){const e=new Date,t=new u(c),n=document.getElementById("trackingToggle"),i=document.getElementById("titleInput");this.startInterval(e),n.innerHTML="Stop Tracking",await t.start(i.value,e).then(o=>{o.error?(console.log(o.error),n.innerHTML="Start Tracking",this.stopInterval(),this.trackingTime="--:--:--"):console.log("tracking started!")})},async stopTracking(){const e=new Date,t=new u(c),n=document.getElementById("trackingToggle"),i=document.getElementById("titleInput");this.stopInterval(),this.trackingTime="00:00:00",i.value="",sessionStorage.removeItem("trackingTitle"),n.innerHTML="Start Tracking",await t.stop(e).then(o=>{o.error&&console.log(o.error),this.fetchAutocompletionItems(),console.log("tracking stopped!")})},async updateTracking(e){var g;const t=new u(c),{data:n,error:i}=await t.getCurrentTracking(),o=n!=null&&n.start?new Date(n.start):null;if(i){console.log(i);return}const s=document.getElementById("trackingToggle"),a=document.getElementById("titleInput");o&&!this.isIntervalRunning()?(console.log("tracking has changed to running"),this.startInterval(o),s.innerHTML="Stop Tracking"):!o&&this.isIntervalRunning()&&(console.log("tracking has changed to stopped"),this.trackingTime="00:00:00",a.value="",sessionStorage.removeItem("trackingTitle"),this.stopInterval(),s.innerHTML="Start Tracking"),this.isIntervalRunning()?(a.value=((g=e.title)==null?void 0:g.toString())||"",sessionStorage.setItem("trackingTitle",a.value)):a.value=sessionStorage.getItem("trackingTitle")||""},startInterval(e){const n=new Date().getTime()-e.getTime(),i=new Date(n);this.trackingTime=this.formatDate(i),this.intervalId=setInterval(()=>{const s=new Date().getTime()-e.getTime(),a=new Date(s);this.trackingTime=this.formatDate(a)},1e3)},stopInterval(){clearInterval(this.intervalId),this.intervalId=null},isIntervalRunning(){return this.intervalId!=null},formatDate(e){const t=e.getUTCHours().toString().padStart(2,"0"),n=e.getUTCMinutes().toString().padStart(2,"0"),i=e.getUTCSeconds().toString().padStart(2,"0");return`${t}:${n}:${i}`},async updateTitle(){const e=document.getElementById("titleInput"),t=new u(c);sessionStorage.setItem("trackingTitle",e.value),this.isIntervalRunning()&&await t.update({title:e.value},null)},async updateAutocompletion(){const e=document.getElementById("titleInput");sessionStorage.getItem("autocompletionItems")||await this.fetchAutocompletionItems();const t=e.value.toLowerCase(),n=JSON.parse(sessionStorage.getItem("autocompletionItems")||"[]");if(e.value.length==0){this.autocompletionItems=n.slice(0,1);return}const i=n.filter(o=>o.title.toLowerCase().includes(t));i.sort((o,s)=>s.amount-o.amount),this.autocompletionItems=i.slice(0,3)},selectAutocompleteItem(e){const t=document.getElementById("titleInput"),n=e.title;t.value=n,this.updateTitle(),this.autocompletionItems=[]},async fetchAutocompletionItems(){const t=await new u(c).getTitles();if(t.error){console.log(t.error);return}sessionStorage.setItem("autocompletionItems",JSON.stringify(t.data))}},setup(){const e=h("--:--:--");return l.show(),{trackingTime:e}},async mounted(){const e=new u(c);await e.getCurrentTracking().then(t=>{var i;const n=(i=t.data)!=null&&i.start?new Date(t.data.start):null;if(t.error){console.log(t.error),l.hide();return}n||(this.trackingTime="00:00:00"),this.updateTracking(t.data)}),await e.getTitles().then(t=>{if(t.error){console.log(t.error);return}sessionStorage.setItem("autocompletionItems",JSON.stringify(t.data))}),document.addEventListener("click",t=>{const n=document.getElementById("titleInput");t.target!=n&&(this.autocompletionItems=[])}),B=c.channel("public:trackings").on("postgres_changes",{event:"*",schema:"public",table:"trackings"},async t=>{this.updateTracking(t.new)}).subscribe(),l.hide()}};const I=e=>(w("data-v-1efa3948"),e=e(),_(),e),E=I(()=>r("h1",{class:"title"},"Current Tracking",-1)),b={class:"tracking-container"},C={class:"autocomplete"},A={class:"tracking-title-container"},L={class:"autocomplete-items"},R=["onClick"],x=I(()=>r("br",null,null,-1)),H={style:{"font-size":"small"}},M={class:"tracking-time",id:"trackingTime"},N=I(()=>r("img",{src:S,alt:"tags",class:"tag-button"},null,-1));function V(e,t,n,i,o,s){return m(),d("main",null,[E,r("div",b,[r("div",C,[r("div",A,[r("input",{autocomplete:"off",class:"tracking-title",type:"text",placeholder:"Title",id:"titleInput",onChange:t[0]||(t[0]=(...a)=>s.updateTitle&&s.updateTitle(...a)),onFocusin:t[1]||(t[1]=(...a)=>s.updateAutocompletion&&s.updateAutocompletion(...a)),onKeyup:t[2]||(t[2]=(...a)=>s.updateAutocompletion&&s.updateAutocompletion(...a))},null,32)]),r("div",L,[(m(!0),d(T,null,v(o.autocompletionItems,a=>(m(),d("div",{onClick:g=>s.selectAutocompleteItem(a)},[f(p(a.title)+" ",1),x,r("p",H,p(new Date(a.last_use).toLocaleDateString()),1)],8,R))),256))])]),r("h3",M,p(i.trackingTime),1),N]),r("a",{id:"trackingToggle",class:"button is-primary",href:"#",onClick:t[3]||(t[3]=(...a)=>s.toggleTracking&&s.toggleTracking(...a))},"Start Tracking")])}const J=k(D,[["render",V],["__scopeId","data-v-1efa3948"]]);export{J as default};
