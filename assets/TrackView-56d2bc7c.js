var p=Object.defineProperty;var T=(e,t,r)=>t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var l=(e,t,r)=>(T(e,typeof t!="symbol"?t+"":t,r),r);import{r as h,s as d,_ as m,a as f,c as S,b as i,t as w,p as _,g as I}from"./index-bde6c963.js";class g{constructor(t){l(this,"supabase");this.supabase=t}async add(t,r,a){const n=await this.checkSession();if(!n)return{data:null,error:"User not logged in"};const s=r.toISOString(),o=(a==null?void 0:a.toISOString())||null,{data:c,error:k}=await this.supabase.from("trackings").insert([{title:t,start:s,end:o,user:n==null?void 0:n.id}]);return{data:c,error:k}}async start(t,r){return await this.add(t,r,null)}async stop(t){const r=await this.checkSession();if(!r)return{data:null,error:"User not logged in"};const a=t.toISOString(),{data:n,error:s}=await this.supabase.from("trackings").select("id").eq("user",r==null?void 0:r.id).is("end",null);if(n&&n.length==1){const{data:o,error:c}=await this.supabase.from("trackings").update({end:a}).eq("id",n[0].id);return{data:o,error:c}}else return{data:null,error:"No tracking to stop"}}async getCurrentTrackingStartTime(){const t=await this.checkSession();if(!t)return{date:null,error:"User not logged in"};const{data:r,error:a}=await this.supabase.from("trackings").select("start").eq("user",t==null?void 0:t.id).is("end",null);return r&&r.length>0?{date:new Date(r[0].start),error:null}:{date:null,error:null}}async checkSession(){var a;const{data:t,error:r}=await this.supabase.auth.getSession();return t?(a=t.session)==null?void 0:a.user:!1}}const v={name:"TrackView",data(){return{trackingTime:"00:00:00",intervalId:setInterval(()=>{},1e3)}},methods:{async toggleTracking(){const e=document.getElementById("trackingToggle"),t=new g(d),r=new Date,{date:a,error:n}=await t.getCurrentTrackingStartTime();if(n){console.log(n);return}if(a){const s=await t.stop(r);if(s.error){console.log(s.error);return}this.stopIntervall(),this.trackingTime="00:00:00",e.innerHTML="Start Tracking";return}else await t.start("tracking!",r),this.startIntervall(r);e.innerHTML="Stop Tracking"},startIntervall(e){this.intervalId=setInterval(()=>{const r=new Date().getTime()-e.getTime(),a=new Date(r),n=a.getUTCHours().toString().padStart(2,"0"),s=a.getUTCMinutes().toString().padStart(2,"0"),o=a.getUTCSeconds().toString().padStart(2,"0");this.trackingTime=`${n}:${s}:${o}`},1e3)},stopIntervall(){clearInterval(this.intervalId)}},setup(){return{trackingTime:h("00:00:00")}},async mounted(){const e=new g(d),{date:t,error:r}=await e.getCurrentTrackingStartTime();if(r){console.log(r);return}if(t){this.startIntervall(t);const a=document.getElementById("trackingToggle");a.innerHTML="Stop Tracking"}}};const u=e=>(_("data-v-c7548c86"),e=e(),I(),e),y=u(()=>i("h1",{class:"title"},"Current Tracking",-1)),b={id:"trackingTime"},D=u(()=>i("br",null,null,-1));function E(e,t,r,a,n,s){return f(),S("main",null,[y,i("div",null,[i("h3",b,w(a.trackingTime),1)]),D,i("a",{id:"trackingToggle",class:"button is-primary",href:"#",onClick:t[0]||(t[0]=(...o)=>s.toggleTracking&&s.toggleTracking(...o))},"Start Tracking")])}const U=m(v,[["render",E],["__scopeId","data-v-c7548c86"]]);export{U as default};
