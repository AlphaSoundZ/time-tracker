import{d as k,r as w,o as I,t as T,s as c,a as r,c as l,b as t,F as m,e as D,f as o,g as S,p as N,h as J,_ as O}from"./index-2c932901.js";import{T as V}from"./track-03cf0993.js";const u=_=>(N("data-v-1cef042a"),_=_(),J(),_),x={class:"container"},L=u(()=>t("h1",null,"Dashboard",-1)),M={key:0,hidden:""},B={class:"table"},E=u(()=>t("thead",null,[t("tr",null,[t("th",null,"Title"),t("th",null,"Date"),t("th",null,"Start"),t("th",null,"End"),t("th",null,"Duration")])],-1)),G=u(()=>t("td",{colspan:"4"},"Total",-1)),C={key:1},F={class:"groups"},$=u(()=>t("br",null,null,-1)),j={class:"table"},q=u(()=>t("thead",null,[t("tr",null,[t("th",null,"Start"),t("th",null,"End"),t("th",null,"Duration")])],-1)),z={key:2,class:"title"},A=u(()=>t("h2",null,"No trackings yet",-1)),H=[A],K=u(()=>t("br",null,null,-1)),P=k({__name:"DashboardView",setup(_){const d=w([]),h=w([]);async function b(){const n=sessionStorage.getItem("trackings");if(n&&n!=="[]")d.value=JSON.parse(n);else{const{data:i}=await c.from("trackings").select().order("start",{ascending:!1});d.value=i,sessionStorage.setItem("trackings",JSON.stringify(d.value))}const a=sessionStorage.getItem("groupedTrackings");a&&a!=="[]"&&(h.value=JSON.parse(a));const e=new V(c),{data:s}=await e.getTrackingGroups();h.value=s,sessionStorage.setItem("groupedTrackings",JSON.stringify(s)),c.channel("any").on("postgres_changes",{event:"*",schema:"public",table:"trackings"},async i=>{const{data:p}=await c.from("trackings").select().order("start",{ascending:!1});d.value=p,sessionStorage.setItem("trackings",JSON.stringify(d.value))}).subscribe()}function v(n){if(!n.end)return"in progress";const a=new Date(n.start),s=new Date(n.end).getTime()-a.getTime();return f(s)}function f(n){n=new Date(n).getTime();const a=Math.floor(n/1e3/60/60),e=Math.floor(n/1e3/60)%60,s=Math.floor(n/1e3)%60;return[a,e,s].map(p=>String(p).padStart(2,"0")).join(":")}function g(n){if(n)return new Date(n).toLocaleTimeString().slice(0,8)}function y(n){let a=new Date(n.start).toLocaleDateString();if(n.end){let e=new Date(n.end).toLocaleDateString();return a===e?a:`${a} - ${e}`}return a}return I(async()=>{var e;T.show();const{data:n,error:a}=await c.auth.getSession();n&&((e=n.session)==null||e.user,b().then(()=>{T.hide()}))}),(n,a)=>(r(),l("div",x,[L,d.value.length!==0?(r(),l("div",M,[t("table",B,[E,t("tbody",null,[(r(!0),l(m,null,D(d.value,e=>(r(),l("tr",{key:e.id},[t("td",null,o(e.title),1),t("td",null,o(y(e)),1),t("td",null,o(g(e.start)),1),t("td",null,o(e.end?g(e.end):""),1),t("td",null,o(v(e)),1)]))),128))]),t("tfoot",null,[t("tr",null,[G,t("td",null,o(f(d.value.map(e=>e.end?new Date(e.end).getTime()-new Date(e.start).getTime():0).reduce((e,s)=>e+s,0))),1)])])])])):S("",!0),h.value.length!==0?(r(),l("div",C,[(r(!0),l(m,null,D(h.value,e=>(r(),l("div",F,[$,t("h2",null,o(e[0].title)+" on "+o(e[0].end?new Date(e[0].end).toDateString():"")+" ("+o(f(e.map(s=>s.end?new Date(s.end).getTime()-new Date(s.start).getTime():0).reduce((s,i)=>s+i,0)))+")",1),t("table",j,[q,t("tbody",null,[(r(!0),l(m,null,D(e,s=>(r(),l("tr",{key:s.id},[t("td",null,o(g(s.start)),1),t("td",null,o(s.end?g(s.end):""),1),t("td",null,o(v(s)),1)]))),128))])])]))),256))])):S("",!0),d.value.length===0?(r(),l("div",z,H)):S("",!0),K]))}});const U=O(P,[["__scopeId","data-v-1cef042a"]]);export{U as default};
